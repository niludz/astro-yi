---
title: 我理解的Javascript原型
date: 2024-03-30
category: 计算机网络
tags: ["HTTP"]

mermaid: true
mathjax: true
---


旨在记录一些HTTP的‘死’知识（状态码和首部），方便查阅记忆。

# 状态码

状态码类别：

|      | 类别                             | 原因短语                     |
| ---- | -------------------------------- | ---------------------------- |
| 1xx  | Information（信息性状态码）      | 接收的请求正在处理。         |
| 2xx  | Success（成功状态码）            | 请求正常处理完毕。           |
| 3xx  | Redirection（重定向状态码）      | 需要进行附加操作以完成请求。 |
| 4xx  | Client Error（客户端错误状态码） | 服务器无法处理请求。         |
| 5xx  | Server Error（服务器错误状态码） | 服务器处理请求出错。         |

## 2XX 成功

- **200 OK** ：表示请求被正常处理了。在响应报文内，随状态码一起返回的信息会因方法的不同而发生改变（使用**GET**方法时，对应请求实体会作为响应返回；使用**HEAD**方法时，在响应中只返回首部，不会返回实体的主体部分）。
- **204 No Content** ：代表服务器接收的请求已成功处理，但在返回的响应报文中不含实体的主体部分，也不允许返回。一般在只需要从客户端往服务器发送信息，而客户端不需要发送新信息内容的情况下使用。
- **206 Partial Content** ：响应报文中包含由**Content-Range**指定范围的实体内容。

## 3XX 重定向

- **301 Moved Permanently** ：永久重定向。如果已经把资源对应的URI保存为书签了，这时应该按**Location**首部字段提示的URI重新保存。
- **302 Found**  ：临时重定向。希望用户（本次）能使用新的URI访问。已移动的资源对应的URI将来还有可能发生改变。
- **303 See Other** ：请求对应的资源存在着另一个URI，应使用**GET**方法定向获取请求的资源。

> 当301，302，303响应状态码返回时，几乎所有浏览器都会把POST改为GET，并删除请求报文内的主体，之后请求会自动再次发送。

- **304 Not Modified** ：客户端发送**附带条件（请求报文中包含If-Match，If-Range...的首部）**的请求，服务器允许请求访问资源，但因为请求未满足条件，返回304。

- **307 Temporary Redirect** ：临时重定向，与302相同。

## 4XX 客户端错误

- **400 Bad Request** ：请求报文中存在语法错误。另外，浏览器会像200一样对待该状态码。
- **401 Unauthorized** ：发送的请求需要有通过HTTP认证（BASIC，DIGEST）的认证信息。返回含有401的响应必须包含一个适用于被请求资源的WWW-Authenticate首部用以质询（challenge）用户信息。

- **403 Forbidden** :对请求资源的访问被服务器拒绝了。可能是访问权限的问题。
- **404 Not Found** ：服务器上无法找到请求的资源。

## 5XX 服务器错误

- **500 Internal Server Error** ：服务器端在执行请求时发生了错误。也可能是Web应用存在的bug或某些临时的故障。
- **503 Service Unavailable** ：服务器暂时处于超负荷或正在进行停机维护。如果得知解除状况需要的时间，最好写入**Retry-After**首部字段返回给客户端。

# HTTP首部字段

使用首部字段是为了给浏览器和服务器提供报文主体大小、所使用的语言、认证信息等内容。

## 通用首部字段

### Cache-Control

用来操作缓存的工作机制，指令的参数是可选的，多个指令通过逗号分隔。

请求指令

| 指令             | 说明                                                         |
| ---------------- | ------------------------------------------------------------ |
| no-cache         | 强制向源服务器再次验证                                       |
| no-store         | 不缓存请求或响应的任何内容                                   |
| max-age=[秒]     | 响应的最大age值                                              |
| max-stale(=[秒]) | 接收已过期的响应（即使过期也照样接收）                       |
| min-fresh=[秒]   | 期望在指定时间内的响应仍有效（这缓存再过xxx秒还算是新鲜的吗？） |
| no-transform     | 代理不可更改媒体类型（可以防止缓存或代理压缩图片等操作）     |
| only-if-cached   | 从缓存获取资源                                               |
| cache-extension  | 新指令标记（token）                                          |

响应指令

| 指令             | 说明                                                     |
| ---------------- | -------------------------------------------------------- |
| public           | 可向任意方提供响应的缓存                                 |
| private          | 仅向特定用户返回响应                                     |
| no-cache         | 缓存前必须先确认其有效性                                 |
| no-store         | 不缓存请求或响应的任何内容                               |
| no-transform     | 代理不可更改媒体类型（可以防止缓存或代理压缩图片等操作） |
| must-revalidate  | 可缓存但必须再向源服务器进行确认                         |
| proxy-revalidate | 要求中间服务器对缓存的响应有效性再进行确认               |
| max-age=[秒]     | 响应的最大age值                                          |
| s-maxage=[秒]    | 公共缓存服务器响应的最大age值                            |
| cache-extension  | 新指令标记（token）                                      |

### Connection

- 控制不在转发给代理的首部字段；
- 管理持久链接（Keep-Alive，Close）。

### Date

创建HTTP报文的日期和时间。

### Pragma

HTTP/1.1之前版本的历史遗留字段，仅作为与HTTP/1.0的向后兼容而定义。客户端会要求所有的中间服务器不返回缓存的资源。

规范定义形式唯一

```
Prama: no-cache
```

为了兼容HTTP/1.1之前的协议版本，一般使用

```
Cache-Control: no-cache
Prama: no-cache
```

### Trailer

会事先说明在报文主体后记录了哪些首部字段。该首部字段可应用在HTTP/1.1版本分块传输编码时。

### Transfer-Encoding

规定了传输报文主体时采用的编码方式。

### Upgrade

- 用于检测HTTP协议是否可使用更高的版本进行通信，其参数值可以指定另外一个完全不同的通信协议（例如TLS/1.0）。
- 使用Upgrade时，需要额外指定Connection：Upgrade。
- 对于附有Upgrade的请求，服务器可用**101 Switching Protocols**状态码作为响应返回。

### Vid

- 为了追踪客户端与服务器之间的请求和响应报文的传播路径。
- 各个代理服务器会往Via首部添加自身服务器的信息。

### Warning

- HTTP/1.1的Warning首部是从HTTP/1.0的响应首部（**Retry-After**）演变过来的。该首部会告知用户一些与缓存相关的问题的警告。
- 格式如下，日期可省略。

```
Warning: [警告码][警告的主机好：端口号]“[警告内容]”([日期时间])
```

- 警告码

| 警告码 | 警告内容                                   | 说明                                                         |
| ------ | ------------------------------------------ | ------------------------------------------------------------ |
| 110    | Response is stale(响应已过期)              | 代理响应已过期的资源                                         |
| 111    | Revalidation failed(再验证失败)            | 代理再验证资源有效性时失败（服务器无法到达等原因）           |
| 112    | Disconnection operation(断开连接操作)      | 代理与互联网连接被故意切断                                   |
| 113    | Heuristic expiration(试探性过期)           | 响应的使用期超过24小时（有效缓存的设定时间大于24小时的情况下） |
| 199    | Miscellaneous warning(杂项警告)            | 任意警告                                                     |
| 214    | Transformation applied(使用了转换)         | 代理对内容编码或媒体类型等执行了某些处理时                   |
| 299    | Miscellaneous persistent warning(杂项警告) | 任意警告                                                     |

## 请求首部字段

### Accept

Accpet首部字段可通知服务器，用户代理能够处理等媒体类型及媒体类型的相对优先级（使用q来指定，“；”分隔，范围是0～1）。

媒体类型包括：

- 文本文件：text/html,text/plain,text/css,application/xhtml+xml...
- 图片文件：image/jpeg,image/gif,image/png...
- 视频文件：video/mpeg,video/quicktime...
- 应用程序使用的二进制文件：application/octet-stream,application/zip...

### Accept-Charset

用来通知服务器，用户代理支持的字符集及字符集的相对优先顺序（使用q来指定）。

### Accept-Encoding

用来通知服务器，用户代理支持的内容编码及内容编码的相对优先级（使用q来指定）。

### Accept-Language

用来通知服务器，用户代理支持的自然语言集（中文/英文）及自然语言集的相对优先级（使用q来指定）。

### Authorization

告知服务器，用户代理的认证信息（证书值）。

### Expect

告知服务器，期望出现某种特定的行为。HTTP/1.1规范只定义了100--continue。

### From

告知服务器，使用用户代理的用户的电子邮箱地址。目的就是为了显示搜索引擎等负责人的电子邮件联系方式。

### Host

告知服务器，请求的资源所处的互联网主机名和端口号。请求被发送至服务器时，请求中的主机名会直接用IP地址直接替换，但如果相同的IP地址下部署运行着多个域名，服务器无法理解是哪个域名对应的请求，因此就需要**host**来明确指出请求的主机名。

### If-Match

> 形如If-xxx这种样式的请求首部，都可称为条件请求。

告知服务器，匹配资源所使用的实体标记值（**ETag**）。这时服务器无法使用弱**ETag**值。服务器会对比**If-Match**的字段值和资源的**ETag**值，仅当两者一致时才会执行请求，否则返回**412 Precondition Failed**的响应。

### If-Modified-Since

如果在**If-Modified-Since**字段指定的日期时间后，资源发生了更新，服务器会接受请求。

### If-None-Match

只有在**If-None-Match**的字段值与**ETag**值不一致时，可处理该请求，与**If-Match**作用相反。

### If-Range

告知服务器若指定的**If-Range**值（ETag值/时间）与请求资源的ETag值或时间相一致时，作为范围请求处理，反之，返回全部资源。

### If-Unmodified-Since

如果在**If-Unmodified-Since**字段指定的日期时间后，资源未发生了更新，服务器会接受请求。与**If-Modified-Since**作用相反。

### Max-Forwards

该字段以十进制整数形式指定可经过的服务器最大数目。服务器在往下一个服务器转发请求之前，会将**Max-Forwards**的值-1后重新赋值，当服务器接收到该值为0的请求时，不在进行转发，直接返回响应。

### Proxy-Authorization

告知服务器，用户代理的认证信息（证书值）。与**Authorization**不同的是，它发生在客户端和代理之间。

### Range

获取部分资源的范围请求。

### Referer

告知服务器请求的原始资源的URI。

### TE

告知服务器，客户端能够处理响应的传输编码方式及相对优先级。

### User-Agent

创建请求浏览器和用户代理名称等信息传达给服务器。

## 响应首部字段

### Accept-Range

告知客户端，服务器是否能够处理范围请求，可以返回bytes，不能返回none。

### Age

告知客户端，源服务器在多久前创建了响应，单位为秒。代理创建响应时，必须加上Age。

### ETag

- 它是一种可将资源以字符串形式做唯一性标识的方式。服务器会为每一份资源分配对应的ETag值。
- 当资源更新时，ETag值也需要更新，生成ETag时，没有统一的算法规则，仅仅由服务器来分配。
    - 强ETag：不论实体发生多么细微的变化，都会改变其值
    - 弱ETag：只用于提示资源是否相同，只有资源发生了根本改变，产生差异时才会改变ETag值，会在字段最开始处附加W/。

### Location

提供重定向的URI，将响应接收方引导至某个与请求URI位置不同的资源。

### Proxy-Authenticate

将代理服务器所要求的认证信息发送给客户端。

### Retry-After

告知客户端，在多久之后再次发送请求。配合503或3xx响应一起使用。

### Server

告知客户端，当前服务器上安装的HTTP服务器应用程序的信息，包括版本号和安装时启动的可选项。

### Vary

可对缓存进行控制，是源服务器向代理服务器传达关于本地缓存使用方法的命令。（当代理服务器接收到源服务器返回包含Vary指定项的响应后，若要进行缓存，只缓存请求中含有相同Vary指定的首部字段的请求，即使对相同资源发起请求，由于Vary指定的首部字段不同，必须从源服务器重新获取资源）

### WWW-Authenticate

用于HTTP访问认证。告知客户端适用于访问请求URI所指定资源的认证方案（Basic/Digst）和带参数提示的质询。

## 实体首部字段

> 实体首部字段是包含请求报文和响应报文中实体部分所使用的首部，用于补充内容的更新时间等实体相关的信息。

### Allow

告知客户端能够支持Request-URI指定资源的所有HTTP方法（GET，HEAD...），当服务器收到不支持的HTTP方法时，返回405，与此同时还会把支持的方法写入Allow字段返回。

### Content-Encoding

告知客户端，服务器对实体的主体部分选用的内容编码方式。内容编码时指在不丢失实体信息的前提下所进行的压缩。

### Content-Language

告知客户端，实体主体所使用的自然语言（中/英...）。

### Content-Length

实体主体部分的大小，单位为字节。

### Content-Location

给出报文主体部分相对应的URI。

### Content-MD5

是一串由MD5算法生成的值，目的在于检查报文主体在传输过程中是否保持完整，以及确认传输到达。对报文主体执行MD5算法获得128二进制数，由于HTTP首部无法记录二进制，所以再通过base64编码后，再将结果写入。

### Content-Range

告知客户端，返回主体的哪个部分，单位为字节。

### Content-Type

实体主体内，对象的媒体类型。

### Expires

告知客户端，资源的失效日期。

### Last-Modified

指明资源最终的修改日期。

参考链接：

[《图解HTTP》](https://book.douban.com/subject/25863515/)

